<div class="timetable-fullscreen">
  <div
    *ngIf="nextBreakMinutes !== null && nextBreakMinutes >= 0 && nextBreakSeconds !== null"
    class="next-break-timer"
  >
    <span>הפסקה בעוד {{ nextBreakMinutes }}:{{ nextBreakSeconds < 10 ? '0' + nextBreakSeconds : nextBreakSeconds }} ({{ nextBreakLabel }})</span>
  </div>
  <div
    *ngIf="endOfDayHours !== null && endOfDayMinutes !== null && endOfDaySeconds !== null"
    class="end-of-day-timer"
  >
    <span>סוף יום בעוד {{ endOfDayHours }}:{{ endOfDayMinutes < 10 ? '0' + endOfDayMinutes : endOfDayMinutes }}:{{ endOfDaySeconds < 10 ? '0' + endOfDaySeconds : endOfDaySeconds }}</span>
  </div>
  <div style="margin-bottom: 1em; text-align: right">
    <label class="single-day-toggle">
      <input
        type="checkbox"
        [checked]="showTodayOnly"
        (change)="toggleTodayOnly()"
      />
      Show only today
    </label>
  </div>

  <p-table
    *ngIf="filteredView as v; else empty"
    [value]="v.rows"
    [scrollable]="true"
    scrollHeight="auto"
    responsiveLayout="scroll"
    [tableStyle]="showTodayOnly ? { 'min-width': '0', width: '100%' } : { 'min-width': '940px' }"
    [styleClass]="
      'timetable-table pony-timetable' + (showTodayOnly ? ' single-day' : '')
    "
  >
    <ng-template pTemplate="header">
      <tr>
        <th class="sticky-col period-col">Period</th>
        <th
          *ngFor="let day of v.dayHeaders; trackBy: trackDay"
          class="day-col"
          [class.is-today]="isToday(day)"
        >
          {{ day | titlecase }}
        </th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-row>
      <tr [class.is-now-row]="isNowRow(row.periodId)">
        <td class="sticky-col period-col">
          <div class="period-title">{{ row.title }}</div>
          <div class="period-time">{{ row.start }}–{{ row.end }}</div>
        </td>

        <td
          *ngFor="let day of v.dayHeaders; trackBy: trackDay"
          class="cell"
          [class.is-now]="isNowCell(day, row.periodId)"
        >
          <ng-container *ngIf="row.cells[day] as c; else dash">
            <div
              class="class-chip"
              [ngStyle]="{
                'background-color': c.color,
                color: textColorFor(c.color),
              }"
              title="{{ c.teacher }}{{ c.room ? ' · ' + c.room : '' }}"
            >
              <div class="chip-subject">{{ c.subject }}</div>
              <div class="chip-meta">
                {{ c.teacher
                }}<ng-container *ngIf="c.room"> · {{ c.room }}</ng-container>
              </div>
            </div>
            <div class="cell-notes" *ngIf="c.notes">{{ c.notes }}</div>
          </ng-container>
          <ng-template #dash><span class="muted">—</span></ng-template>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <ng-template #empty>
    <div class="muted">No timetable data</div>
  </ng-template>
</div>
